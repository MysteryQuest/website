<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Mystery Quest - Is it a Hoax? Community Voting on Mysterious Events</title>
    <meta name="title" content="Mystery Quest - Is it a Hoax? Community Voting on Mysterious Events">
    <meta name="description" content="Vote on mysterious events and help determine what's real and what's a hoax. Explore UFO sightings, historical mysteries, and unexplained phenomena with community voting and expert analysis.">
    <meta name="keywords" content="Mystery Quest, hoax voting, UFO hoax, mystery voting, paranormal hoax, UAP verification, historical mysteries, unexplained phenomena, community voting, mystery analysis">
    <meta name="author" content="Mystery Quest Team">
    <meta name="robots" content="index, follow">
    <meta name="language" content="en">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mysteryquest.info/hoax.html">
    <meta property="og:title" content="Mystery Quest - Is it a Hoax? Community Voting">
    <meta property="og:description" content="Vote on mysterious events and help determine what's real and what's a hoax. Community-driven mystery analysis and verification.">
    <meta property="og:image" content="https://mysteryquest.info/logo.png">
    <meta property="og:site_name" content="Mystery Quest">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mysteryquest.info/hoax.html">
    <meta property="twitter:title" content="Mystery Quest - Is it a Hoax? Community Voting">
    <meta property="twitter:description" content="Vote on mysterious events and help determine what's real and what's a hoax. Community-driven mystery analysis.">
    <meta property="twitter:image" content="https://mysteryquest.info/logo.png">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebPage",
      "name": "Mystery Quest - Is it a Hoax? Community Voting",
      "description": "Vote on mysterious events and help determine what's real and what's a hoax. Community-driven mystery analysis and verification.",
      "url": "https://mysteryquest.info/hoax.html",
      "mainEntity": {
        "@type": "Organization",
        "name": "Mystery Quest",
        "url": "https://mysteryquest.info",
        "description": "Interactive platform for exploring and analyzing mysterious events, UFO sightings, and unexplained phenomena"
      },
      "about": {
        "@type": "Thing",
        "name": "Mystery Analysis and Hoax Detection",
        "description": "Community-driven platform for voting on and analyzing mysterious events to determine their authenticity"
      }
    }
    </script>
    
    <!-- AI Search Optimization -->
    <meta name="ai-search-description" content="Interactive hoax detection platform where users vote on mysterious events including UFO sightings, paranormal phenomena, and historical mysteries to determine authenticity through community analysis">
    <meta name="content-type" content="interactive voting platform">
    <meta name="topic-category" content="mystery analysis, hoax detection, community voting">
    
    <link rel="canonical" href="https://mysteryquest.info/hoax.html">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="styles.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
    <style>
        /* Google Translate Widget Styling */
        #google_translate_element {
            margin-right: 15px;
        }
        
        .goog-te-gadget {
            font-family: inherit !important;
            font-size: 12px !important;
        }
        
        .goog-te-gadget-simple {
            background-color: #333 !important;
            border: 1px solid #555 !important;
            padding: 5px 8px !important;
            border-radius: 4px !important;
            color: #ffffff !important;
        }
        
        .goog-te-gadget-simple .goog-te-menu-value {
            color: #ffffff !important;
        }
        
        .goog-te-gadget-simple .goog-te-menu-value:hover {
            text-decoration: none !important;
        }
        
        .goog-te-gadget-icon {
            display: none !important;
        }
        
        .goog-te-gadget-simple .goog-te-menu-value span {
            color: #ffffff !important;
        }
        
        /* Hide the Google Translate banner */
        .goog-te-banner-frame {
            display: none !important;
        }
        
        body {
            top: 0 !important;
        }
        
        /* Carousel and voting styling */
        .carousel-item {
            padding: 20px;
        }
        
        .mystery-img {
            max-width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .mystery-map {
            height: 300px;
            width: 100%;
            border-radius: 8px;
            border: 2px solid #333;
        }
        
        .image-map-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .image-container, .map-container {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
        }
        
        .btn-vote {
            min-width: 100px;
            padding: 10px 20px;
        }
        
        .result {
            background: #1f1f1f;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        /* Mobile responsive styles for hoax page */
        @media (max-width: 768px) {
            /* Header responsive */
            header .container {
                flex-direction: column;
                text-align: center;
            }
            
            header img {
                margin-bottom: 15px;
                height: 50px !important;
            }
            
            .nav-tabs {
                justify-content: center;
                margin: 0;
                flex-wrap: wrap;
            }
            
            .nav-tabs .nav-item {
                margin-bottom: 5px;
            }
            
            .nav-tabs .nav-link {
                padding: 8px 12px;
                font-size: 0.9em;
            }
            
            /* Google Translate element mobile positioning */
            #google_translate_element {
                margin-right: 0;
                margin-top: 5px !important;
            }
            
            /* Carousel responsive */
            .carousel-item {
                padding: 15px 10px;
                min-height: 500px !important;
            }
            
            .carousel-item h2 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            
            .carousel-item p {
                font-size: 0.9em;
                margin-bottom: 10px;
            }
            
            .image-map-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .image-container, .map-container {
                max-width: 100%;
                min-width: 100%;
            }
            
            .mystery-img, .mystery-map {
                max-height: 200px;
                margin-bottom: 15px !important;
            }
            
            .btn-vote {
                display: block;
                width: 100%;
                margin: 5px 0 !important;
                padding: 12px;
                font-size: 1.1em;
            }
            
            .result {
                font-size: 0.9em;
                margin-top: 20px;
            }
            
            /* Container adjustments */
            .container {
                padding-left: 10px;
                padding-right: 10px;
            }
        }
        
        @media (max-width: 480px) {
            header img {
                height: 40px !important;
            }
            
            .nav-tabs .nav-link {
                padding: 6px 8px;
                font-size: 0.8em;
            }
            
            .carousel-item {
                padding: 10px 5px;
                min-height: 420px !important;
            }
            
            .carousel-item h2 {
                font-size: 1.3em;
            }
            
            .carousel-item p {
                font-size: 0.85em;
            }
            
            .mystery-img, .mystery-map {
                max-height: 150px;
            }
            
            .btn-vote {
                font-size: 1em;
                padding: 10px;
            }
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1028115466622942"
     crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5115VTJEF0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-5115VTJEF0');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'es,en',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>
<body>
    <!-- Dynamic Header -->
    <div id="dynamic-header"></div>

    <div class="container py-5 mt-4">
        <div class="text-center mb-5">
            <h1 class="display-4 text-cyan">Vote: Real or Hoax?</h1>
            <p class="lead">Help our community separate fact from fiction</p>
        </div>
        
        <div id="mysteryCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselItems">
                <!-- Dynamically loaded mysteries -->
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyDWYze9-dP4ptq-4vxZVBOCW-Uo9wC7KhQ';
        const SPREADSHEET_ID = '1fJIP4P3Gbm71OKgG_EnIDZ-7nBRoMJOuxvkc2tnC_LQ';
        const SHEET_NAME = 'Sheet1';

        let mysteries = [];
        let mysteryMaps = [];



        async function fetchMysteries() {
            try {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${GOOGLE_SHEETS_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error('Failed to fetch data');
            
            const data = await response.json();

            if (data.values && data.values.length > 1) {
                const headers = data.values[0];
                const rows = data.values.slice(1);
                
                // First map rows with their original spreadsheet indices
                mysteries = rows
                    .map((row, index) => {
                        const mystery = {};
                        headers.forEach((header, i) => {
                            mystery[header] = row[i] || '';
                        });
                        
                        // Clean display fields to prevent JSON leakage
                        Object.keys(mystery).forEach(key => {
                            if (['name', 'description', 'location', 'event_type'].includes(key.toLowerCase())) {
                                const value = mystery[key];
                                // Check if this looks like JSON and filter it out
                                if (value && (value.includes('{"') || value.includes('"source_credibility"') || value.includes('"primary_category"'))) {
                                    console.warn(`⚠️ Filtered JSON content from ${key}:`, value.substring(0, 50));
                                    mystery[key] = '';
                                }
                            }
                        });
                        mystery.id = index;
                // Store the actual spreadsheet row index (offset by 2 for header and 1-based index)
                mystery.spreadsheetRowIndex = index + 2;
                // Map spreadsheet columns to JS property names
                mystery.realVotes = parseInt(mystery.votes || '0');
                mystery.hoaxVotes = parseInt(mystery.hoax || '0');
                return mystery;
                })
                .filter(mystery => mystery.image_url && mystery.image_url.trim() !== '' && mystery.real_or_hoax == 'True');

            // Shuffle the mysteries array after mapping
            for (let i = mysteries.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [mysteries[i], mysteries[j]] = [mysteries[j], mysteries[i]];
            }

            renderCarousel();
            }
        }

        function renderCarousel() {
            const container = document.getElementById("carouselItems");
            container.innerHTML = "";
            mysteryMaps = []; // Clear existing maps
            
            mysteries.forEach((mystery, index) => {
                const activeClass = index === 0 ? "active" : "";
                const item = document.createElement("div");
                item.className = `carousel-item ${activeClass}`;
                
                const hasValidImage = mystery.image_url && /\.(jpe?g|png|gif|webp|bmp|svg)$/i.test(mystery.image_url);
                const hasValidCoordinates = mystery.latitude && mystery.longitude && 
                    !isNaN(parseFloat(mystery.latitude)) && !isNaN(parseFloat(mystery.longitude));
                
                // Parse YouTube videos if available
                let youtubeVideos = [];
                try {
                    if (mystery.youtube_videos) {
                        const videoData = JSON.parse(mystery.youtube_videos);
                        youtubeVideos = videoData.videos || [];
                    }
                } catch (e) {
                    // Ignore parsing errors
                }
                
                // Generate YouTube section
                let youtubeSection = '';
                if (youtubeVideos && youtubeVideos.length > 0) {
                    youtubeSection = `
                        <div class="youtube-section mt-3">
                            <h6><i class="fab fa-youtube text-danger"></i> Related Videos</h6>
                            <div class="row justify-content-center">
                    `;
                    
                    youtubeVideos.slice(0, 1).forEach(video => {
                        // Extract video ID for embedding
                        const videoIdMatch = video.url ? video.url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/) : null;
                        const videoId = videoIdMatch ? videoIdMatch[1] : null;
                        
                        if (videoId) {
                            youtubeSection += `
                                <div class="col-md-8 mb-3">
                                    <div class="ratio ratio-16x9">
                                        <iframe 
                                            src="https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1" 
                                            title="${video.title}"
                                            frameborder="0" 
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                            allowfullscreen
                                            loading="lazy">
                                        </iframe>
                                    </div>
                                    <div class="text-center mt-2">
                                        <small class="text-muted">${video.title}</small>
                                    </div>
                                </div>
                            `;
                        } else {
                            youtubeSection += `
                                <div class="col-md-8 mb-3">
                                    <a href="${video.url}" target="_blank" class="btn btn-sm btn-outline-light">
                                        <i class="fab fa-youtube"></i> ${video.title.substring(0, 40)}${video.title.length > 40 ? '...' : ''}
                                    </a>
                                </div>
                            `;
                        }
                    });
                    
                    youtubeSection += `
                            </div>
                        </div>
                    `;
                }
                
                item.innerHTML = `
                    <div class="d-flex flex-column align-items-center justify-content-center text-center" style="min-height: 400px;">
                        <h2>${mystery.name}</h2>
                        <p><strong>Location:</strong> ${mystery.location}</p>
                        ${hasValidImage || hasValidCoordinates ? `
                            <div class="image-map-container">
                                ${hasValidImage ? `
                                    <div class="image-container">
                                        <img src="${mystery.image_url}" alt="${mystery.name}" class="mystery-img">
                                    </div>
                                ` : ''}
                                ${hasValidCoordinates ? `
                                    <div class="map-container">
                                        <div id="map-${index}" class="mystery-map"></div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        <p>${mystery.description}</p>
                        ${youtubeSection}
                        <p><a href="${mystery.url}" target="_blank">${mystery.url}</a></p>
                        <div class="mb-3">
                            <button class="btn btn-success btn-vote me-2" onclick="vote(${index}, 'realVotes')">Real</button>
                            <button class="btn btn-danger btn-vote" onclick="vote(${index}, 'hoaxVotes')">Hoax</button>
                        </div>
                        <div id="result-${index}" class="result"></div>
                    </div>
                `;
                container.appendChild(item);
                
                // Initialize map if coordinates are available
                if (hasValidCoordinates) {
                    setTimeout(() => initializeMap(index, mystery), 100);
                }
            });
        }

        function initializeMap(index, mystery) {
            const mapId = `map-${index}`;
            const mapElement = document.getElementById(mapId);
            
            if (!mapElement) return;
            
            try {
                const lat = parseFloat(mystery.latitude);
                const lng = parseFloat(mystery.longitude);
                
                const map = L.map(mapId).setView([lat, lng], 10);
                
                L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                    attribution: "&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",
                }).addTo(map);
                
                // Add marker for the mystery location
                const marker = L.marker([lat, lng]).addTo(map);
                marker.bindPopup(`
                    <strong>${mystery.name}</strong><br>
                    ${mystery.location}<br>
                    ${mystery.date || 'Date unknown'}
                `);
                
                // Store map reference
                mysteryMaps[index] = map;
                
                // Invalidate size to ensure proper rendering
                setTimeout(() => {
                    map.invalidateSize();
                }, 200);
                
            } catch (error) {
                console.error(`Error initializing map for mystery ${index}:`, error);
            }
        }

        async function vote(index, type) {
            mysteries[index][type]++;
            const real = mysteries[index].realVotes;
            const hoax = mysteries[index].hoaxVotes;
            const total = real + hoax;

            const realPercent = ((real / total) * 100).toFixed(1);
            const hoaxPercent = ((hoax / total) * 100).toFixed(1);

            const result = document.getElementById(`result-${index}`);
            result.innerHTML = `
                <p><strong>Current Results:</strong></p>
                <p>Real: ${realPercent}% (${real})</p>
                <p>Hoax: ${hoaxPercent}% (${hoax})</p>
            `;

            await submitVote(index, type);

            // Show move to next slide after a pause
            setTimeout(() => {
                moveToNextSlide(index);
            }, 800);
        }

        /**
         * Submits the vote to the Google Apps Script endpoint.
         * @param {number} index - The index of the mystery in the mysteries array.
         * @param {string} type - The type of vote ('realVotes' or 'hoaxVotes').
         */
        async function submitVote(index, type) {
            const url = "https://script.google.com/macros/s/AKfycbwj1I4MNz7m3YvpACN3lrQudoSVsHo6GJ_vR--RGV5ZR0G7culcVppGv1Ujn0daTKLe8g/exec";
            
            let column;
            
            if (type === 'realVotes') {
                column = 'votes';
            } else if (type === 'hoaxVotes') {
                column = 'hoax';
            } else {
                console.error('Invalid vote type:', type);
                return;
            }

            const payload = JSON.stringify({
                rowIndex: mysteries[index].spreadsheetRowIndex,
                column: column
            });

            console.log('Submitting vote:', {
                mysteryName: mysteries[index].name,
                rowIndex: mysteries[index].spreadsheetRowIndex,
                column: column,
                type: type
            });

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: payload,
                    mode: "no-cors"
                });
                console.log("Vote submitted successfully.");
            } catch (error) {
                console.error("Error submitting vote:", error);
            }
        }

        function moveToNextSlide(currentIndex) {
            const carousel = document.getElementById('mysteryCarousel');
            const bsCarousel = bootstrap.Carousel.getOrCreateInstance(carousel);
            // Only move to next if not last slide
            if (currentIndex < mysteries.length - 1) {
            bsCarousel.next();
            }
        }

        // Prevent manual and auto-advance
        document.addEventListener('DOMContentLoaded', () => {
            fetchMysteries();
            const carousel = document.getElementById('mysteryCarousel');
            if (carousel) {
                // Disable keyboard navigation
                carousel.addEventListener('keydown', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                });

                // Disable touch/swipe
                carousel.addEventListener('touchstart', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                });

                // Disable mouse drag
                carousel.addEventListener('mousedown', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                });

                // Handle slide changes to resize maps
                carousel.addEventListener('slid.bs.carousel', function(event) {
                    const activeIndex = Array.from(event.target.querySelectorAll('.carousel-item')).indexOf(event.relatedTarget);
                    if (mysteryMaps[activeIndex]) {
                        setTimeout(() => {
                            mysteryMaps[activeIndex].invalidateSize();
                        }, 100);
                    }
                });

                // Prevent auto-advance by removing interval
                const bsCarousel = bootstrap.Carousel.getOrCreateInstance(carousel, { 
                    interval: false, 
                    ride: false, 
                    pause: true, 
                    keyboard: false, 
                    touch: false 
                });
            }
        });
    </script>
    
    <!-- Dynamic Footer -->
    <div id="dynamic-footer"></div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Navigation Management -->
    <script src="js/navigation.js"></script>
</body>
</html>
